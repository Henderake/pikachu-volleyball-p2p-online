(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{10:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const n={SPRITE_SHEET:"../resources/assets/images/sprite_sheet.json",TEXTURES:{},SOUNDS:{}},i=n.TEXTURES;i.PIKACHU=(e,t)=>`pikachu/pikachu_${e}_${t}.png`,i.BALL=e=>`ball/ball_${e}.png`,i.NUMBER=e=>`number/number_${e}.png`,i.SKY_BLUE="objects/sky_blue.png",i.MOUNTAIN="objects/mountain.png",i.GROUND_RED="objects/ground_red.png",i.GROUND_LINE="objects/ground_line.png",i.GROUND_LINE_LEFT_MOST="objects/ground_line_leftmost.png",i.GROUND_LINE_RIGHT_MOST="objects/ground_line_rightmost.png",i.GROUND_YELLOW="objects/ground_yellow.png",i.NET_PILLAR_TOP="objects/net_pillar_top.png",i.NET_PILLAR="objects/net_pillar.png",i.SHADOW="objects/shadow.png",i.BALL_HYPER="ball/ball_hyper.png",i.BALL_TRAIL="ball/ball_trail.png",i.BALL_PUNCH="ball/ball_punch.png",i.CLOUD="objects/cloud.png",i.WAVE="objects/wave.png",i.SACHISOFT="messages/common/sachisoft.png",i.READY="messages/common/ready.png",i.GAME_END="messages/common/game_end.png",i.MARK="messages/ja/mark.png",i.POKEMON="messages/ja/pokemon.png",i.PIKACHU_VOLLEYBALL="messages/ja/pikachu_volleyball.png",i.FIGHT="messages/ja/fight.png",i.WITH_COMPUTER="messages/ja/with_computer.png",i.WITH_FRIEND="messages/ja/with_friend.png",i.GAME_START="messages/ja/game_start.png",i.SITTING_PIKACHU="sitting_pikachu.png";const o=n.SOUNDS;o.BGM="../resources/assets/sounds/bgm.mp3",o.PIPIKACHU="../resources/assets/sounds/WAVE140_1.wav",o.PIKA="../resources/assets/sounds/WAVE141_1.wav",o.CHU="../resources/assets/sounds/WAVE142_1.wav",o.PI="../resources/assets/sounds/WAVE143_1.wav",o.PIKACHU="../resources/assets/sounds/WAVE144_1.wav",o.POWERHIT="../resources/assets/sounds/WAVE145_1.wav",o.BALLTOUCHESGROUND="../resources/assets/sounds/WAVE146_1.wav"},28:function(e,t,s){},50:function(e,t){},52:function(e,t,s){"use strict";s.r(t);var n=s(6),i=s(15);let o=null;function a(){return null===o?Math.floor(32768*Math.random()):Math.floor(32768*o())}class r{constructor(e,t){this.player1=new l(!1,e),this.player2=new l(!0,t),this.ball=new d(!1)}runEngineForNextFrame(e){return function(e,t,s,n){const i=function(e){e.previousPreviousX=e.previousX,e.previousPreviousY=e.previousY,e.previousX=e.x,e.previousY=e.y;let t=e.fineRotation+e.xVelocity/2;t<0?t+=50:t>50&&(t+=-50);e.fineRotation=t,e.rotation=e.fineRotation/10>>0;const s=e.x+e.xVelocity;(s<20||s>432)&&(e.xVelocity=-e.xVelocity);let n=e.y+e.yVelocity;n<0&&(e.yVelocity=1);Math.abs(e.x-216)<25&&e.y>176&&(e.y<=192?e.yVelocity>0&&(e.yVelocity=-e.yVelocity):e.x<216?e.xVelocity=-Math.abs(e.xVelocity):e.xVelocity=Math.abs(e.xVelocity));if(n=e.y+e.yVelocity,n>252)return e.sound.ballTouchesGround=!0,e.yVelocity=-e.yVelocity,e.punchEffectX=e.x,e.y=252,e.punchEffectRadius=20,e.punchEffectY=272,!0;return e.y=n,e.x=e.x+e.xVelocity,e.yVelocity+=1,!1}(s);let o,a;for(let i=0;i<2;i++)0===i?(o=e,a=t):(o=t,a=e),y(s),u(o,n[i],a,s);for(let i=0;i<2;i++){o=0===i?e:t,!0===h(s,o.x,o.y)?!1===o.isCollisionWithBallHappened&&(m(s,o.x,n[i],o.state),o.isCollisionWithBallHappened=!0):o.isCollisionWithBallHappened=!1}return i}(this.player1,this.player2,this.ball,e)}}class c{constructor(){this.xDirection=0,this.yDirection=0,this.powerHit=0}}class l{constructor(e,t){this.isPlayer2=e,this.isComputer=t,this.initializeForNewRound(),this.divingDirection=0,this.lyingDownDurationLeft=-1,this.isWinner=!1,this.gameEnded=!1,this.computerWhereToStandBy=0,this.sound={pipikachu:!1,pika:!1,chu:!1}}initializeForNewRound(){this.x=36,this.isPlayer2&&(this.x=396),this.y=244,this.yVelocity=0,this.isCollisionWithBallHappened=!1,this.state=0,this.frameNumber=0,this.normalStatusArmSwingDirection=1,this.delayBeforeNextFrame=0,this.computerBoldness=a()%5}}class d{constructor(e){this.initializeForNewRound(e),this.expectedLandingPointX=0,this.rotation=0,this.fineRotation=0,this.punchEffectX=0,this.punchEffectY=0,this.previousX=0,this.previousPreviousX=0,this.previousY=0,this.previousPreviousY=0,this.sound={powerHit:!1,ballTouchesGround:!1}}initializeForNewRound(e){this.x=56,!0===e&&(this.x=376),this.y=0,this.xVelocity=0,this.yVelocity=1,this.punchEffectRadius=0,this.isPowerHit=!1}}function h(e,t,s){let n=e.x-t;return Math.abs(n)<=32&&(n=e.y-s,Math.abs(n)<=32)}function u(e,t,s,n){if(!0===e.isComputer&&function(e,t,s,n){n.xDirection=0,n.yDirection=0,n.powerHit=0;let i=t.expectedLandingPointX;if(Math.abs(t.x-e.x)>100&&Math.abs(t.xVelocity)<e.computerBoldness+5){const s=216*Number(e.isPlayer2);(t.expectedLandingPointX<=s||t.expectedLandingPointX>=432*Number(e.isPlayer2)+216)&&0===e.computerWhereToStandBy&&(i=s+108)}Math.abs(i-e.x)>e.computerBoldness+8?e.x<i?n.xDirection=1:n.xDirection=-1:a()%20==0&&(e.computerWhereToStandBy=a()%2);if(0===e.state){Math.abs(t.xVelocity)<e.computerBoldness+3&&Math.abs(t.x-e.x)<32&&t.y>-36&&t.y<10*e.computerBoldness+84&&t.yVelocity>0&&(n.yDirection=-1);const s=216*Number(e.isPlayer2),i=216*(Number(e.isPlayer2)+1);t.expectedLandingPointX>s&&t.expectedLandingPointX<i&&Math.abs(t.x-e.x)>5*e.computerBoldness+64&&t.x>s&&t.x<i&&t.y>174&&(n.powerHit=1,e.x<t.x?n.xDirection=1:n.xDirection=-1)}else if((1===e.state||2===e.state)&&(Math.abs(t.x-e.x)>8&&(e.x<t.x?n.xDirection=1:n.xDirection=-1),Math.abs(t.x-e.x)<48&&Math.abs(t.y-e.y)<48)){!0===function(e,t,s,n){if(a()%2==0)for(let i=1;i>-1;i--)for(let o=-1;o<2;o++){const a=p(i,o,t);if((a<=216*Number(e.isPlayer2)||a>=432*Number(e.isPlayer2)+216)&&Math.abs(a-s.x)>64)return n.xDirection=i,n.yDirection=o,!0}else for(let i=1;i>-1;i--)for(let o=1;o>-2;o--){const a=p(i,o,t);if((a<=216*Number(e.isPlayer2)||a>=432*Number(e.isPlayer2)+216)&&Math.abs(a-s.x)>64)return n.xDirection=i,n.yDirection=o,!0}return!1}(e,t,s,n)&&(n.powerHit=1,Math.abs(s.x-e.x)<80&&-1!==n.yDirection&&(n.yDirection=-1))}}(e,n,s,t),4===e.state)return e.lyingDownDurationLeft+=-1,void(e.lyingDownDurationLeft<-1&&(e.state=0));let i=0;e.state<5&&(i=e.state<3?6*t.xDirection:8*e.divingDirection);const o=e.x+i;e.x=o,!1===e.isPlayer2?o<32?e.x=32:o>184&&(e.x=184):o<248?e.x=248:o>400&&(e.x=400),e.state<3&&-1===t.yDirection&&244===e.y&&(e.yVelocity=-16,e.state=1,e.frameNumber=0,e.sound.chu=!0);const r=e.y+e.yVelocity;if(e.y=r,r<244?e.yVelocity+=1:r>244&&(e.yVelocity=0,e.y=244,e.frameNumber=0,3===e.state?(e.state=4,e.frameNumber=0,e.lyingDownDurationLeft=3):e.state=0),1===t.powerHit&&(1===e.state?(e.delayBeforeNextFrame=5,e.frameNumber=0,e.state=2,e.sound.pika=!0):0===e.state&&0!==t.xDirection&&(e.state=3,e.frameNumber=0,e.divingDirection=t.xDirection,e.yVelocity=-5,e.sound.chu=!0)),1===e.state)e.frameNumber=(e.frameNumber+1)%3;else if(2===e.state)e.delayBeforeNextFrame<1?(e.frameNumber+=1,e.frameNumber>4&&(e.frameNumber=0,e.state=1)):e.delayBeforeNextFrame-=1;else if(0===e.state&&(e.delayBeforeNextFrame+=1,e.delayBeforeNextFrame>3)){e.delayBeforeNextFrame=0;const t=e.frameNumber+e.normalStatusArmSwingDirection;(t<0||t>4)&&(e.normalStatusArmSwingDirection=-e.normalStatusArmSwingDirection),e.frameNumber=e.frameNumber+e.normalStatusArmSwingDirection}!0===e.gameEnded&&(0===e.state&&(!0===e.isWinner?(e.state=5,e.sound.pipikachu=!0):e.state=6,e.delayBeforeNextFrame=0,e.frameNumber=0),function(e){!0===e.gameEnded&&e.frameNumber<4&&(e.delayBeforeNextFrame+=1,e.delayBeforeNextFrame>4&&(e.delayBeforeNextFrame=0,e.frameNumber+=1))}(e))}function m(e,t,s,n){e.x<t?e.xVelocity=-Math.floor(Math.abs(e.x-t)/3):e.x>t&&(e.xVelocity=Math.floor(Math.abs(e.x-t)/3)),0===e.xVelocity&&(e.xVelocity=a()%3-1);const i=Math.abs(e.yVelocity);e.yVelocity=-i,i<15&&(e.yVelocity=-15),2===n?(e.x<216?e.xVelocity=10*(Math.abs(s.xDirection)+1):e.xVelocity=10*-(Math.abs(s.xDirection)+1),e.punchEffectX=e.x,e.punchEffectY=e.y,e.yVelocity=Math.abs(e.yVelocity)*s.yDirection*2,e.punchEffectRadius=20,e.sound.powerHit=!0,e.isPowerHit=!0):e.isPowerHit=!1,y(e)}function y(e){const t={x:e.x,y:e.y,xVelocity:e.xVelocity,yVelocity:e.yVelocity};let s=0;for(;;){s++;const e=t.xVelocity+t.x;if((e<20||e>432)&&(t.xVelocity=-t.xVelocity),t.y+t.yVelocity<0&&(t.yVelocity=1),Math.abs(t.x-216)<25&&t.y>176&&(t.y<192?t.yVelocity>0&&(t.yVelocity=-t.yVelocity):t.x<216?t.xVelocity=-Math.abs(t.xVelocity):t.xVelocity=Math.abs(t.xVelocity)),t.y=t.y+t.yVelocity,t.y>252||s>=1e3)break;t.x=t.x+t.xVelocity,t.yVelocity+=1}e.expectedLandingPointX=t.x}function p(e,t,s){const n={x:s.x,y:s.y,xVelocity:s.xVelocity,yVelocity:s.yVelocity};n.x<216?n.xVelocity=10*(Math.abs(e)+1):n.xVelocity=10*-(Math.abs(e)+1),n.yVelocity=Math.abs(n.yVelocity)*t*2;let i=0;for(;;){i++;const e=n.x+n.xVelocity;if((e<20||e>432)&&(n.xVelocity=-n.xVelocity),n.y+n.yVelocity<0&&(n.yVelocity=1),Math.abs(n.x-216)<25&&n.y>176&&n.yVelocity>0&&(n.yVelocity=-n.yVelocity),n.y=n.y+n.yVelocity,n.y>252||i>=1e3)return n.x;n.x=n.x+n.xVelocity,n.yVelocity+=1}}class g{constructor(){this.topLeftPointX=a()%500-68,this.topLeftPointY=a()%152,this.topLeftPointXVelocity=1+a()%2,this.sizeDiffTurnNumber=a()%11}get sizeDiff(){return 5-Math.abs(this.sizeDiffTurnNumber-5)}get spriteTopLeftPointX(){return this.topLeftPointX-this.sizeDiff}get spriteTopLeftPointY(){return this.topLeftPointY-this.sizeDiff}get spriteWidth(){return 48+2*this.sizeDiff}get spriteHeight(){return 24+2*this.sizeDiff}}class f{constructor(){this.verticalCoord=0,this.verticalCoordVelocity=2,this.yCoords=[];for(let e=0;e<27;e++)this.yCoords.push(314)}}var b=s(10);const w=b.a.SPRITE_SHEET,v=b.a.TEXTURES;class C{constructor(e){const t=e[w].textures;this.mark=k(t,v.MARK,.5,.5),this.mark.x=216,this.mark.y=152,this.container=new n.b,this.container.addChild(this.mark)}get visible(){return this.container.visible}set visible(e){this.container.visible=e}drawMark(e){const t=this.mark;0!==e?e<100?t.alpha=Math.min(1,t.alpha+.04):e>=100&&(t.alpha=Math.max(0,t.alpha-.04)):t.alpha=0}}class I{constructor(e){const t=e[w].textures;this.messages={pokemon:k(t,v.POKEMON,0,0),pikachuVolleyball:k(t,v.PIKACHU_VOLLEYBALL,0,0),withWho:[k(t,v.WITH_COMPUTER,0,0),k(t,v.WITH_FRIEND,0,0)],sachisoft:k(t,v.SACHISOFT,0,0),fight:k(t,v.FIGHT,0,0)},this.sittingPikachuTilesContainer=function(e){const t=new n.b,s=e[v.SITTING_PIKACHU],i=s.width,o=s.height;let a;for(let e=0;e<Math.floor(304/o)+2;e++)for(let r=0;r<Math.floor(432/i)+2;r++)a=new n.f(s),S(t,a,i*r,o*e);return t}(t),this.messages.sachisoft.x=216-this.messages.sachisoft.texture.width/2,this.messages.sachisoft.y=264,this.messages.pikachuVolleyball.x=140,this.messages.pikachuVolleyball.y=80,this.messages.pokemon.x=170,this.messages.pokemon.y=40,this.container=new n.b,this.container.addChild(this.sittingPikachuTilesContainer),this.container.addChild(this.messages.pokemon),this.container.addChild(this.messages.pikachuVolleyball),this.container.addChild(this.messages.withWho[0]),this.container.addChild(this.messages.withWho[1]),this.container.addChild(this.messages.sachisoft),this.container.addChild(this.messages.fight),this.initializeVisibles(),this.sittingPikachuTilesDisplacement=0,this.selectedWithWho=-1,this.selectedWithWhoMessageSizeIncrement=2}get visible(){return this.container.visible}set visible(e){this.container.visible=e,!1===e&&this.initializeVisibles()}initializeVisibles(){for(const e in this.messages)this.messages[e].visible=!1}drawFightMessage(e){const t=[20,22,25,27,30,27,25,22,20],s=this.messages.fight,n=s.texture.width,i=s.texture.height;if(0===e&&(s.visible=!0),e<30){const t=Math.floor(Math.floor(e*n/30)/2),o=Math.floor(Math.floor(e*i/30)/2);s.width=2*t,s.height=2*o,s.x=100-t,s.y=70-o}else{const o=(e+1)%9,a=Math.floor(Math.floor(t[o]*n/30)/2),r=Math.floor(Math.floor(t[o]*i/30)/2);s.width=2*a,s.height=2*r,s.y=70-r,s.x=100-a}}drawSachisoft(e){0===e&&(this.messages.sachisoft.visible=!0,this.messages.sachisoft.alpha=0),this.messages.sachisoft.alpha=Math.min(1,this.messages.sachisoft.alpha+.04),e>70&&(this.messages.sachisoft.alpha=1)}drawSittingPikachuTiles(e){0===e&&(this.sittingPikachuTilesContainer.visible=!0,this.sittingPikachuTilesContainer.alpha=0);const t=this.sittingPikachuTilesContainer.getChildAt(0).texture.height;this.sittingPikachuTilesDisplacement=(this.sittingPikachuTilesDisplacement+2)%t,this.sittingPikachuTilesContainer.x=-this.sittingPikachuTilesDisplacement,this.sittingPikachuTilesContainer.y=-this.sittingPikachuTilesDisplacement,e>30&&(this.sittingPikachuTilesContainer.alpha=Math.min(1,this.sittingPikachuTilesContainer.alpha+.04)),e>70&&(this.sittingPikachuTilesContainer.alpha=1)}drawPikachuVolleyballMessage(e){if(0!==e)if(e>30&&(this.messages.pikachuVolleyball.visible=!0),e>30&&e<=44){const t=195-15*(e-30);this.messages.pikachuVolleyball.x=140+t}else e>44&&e<=55?(this.messages.pikachuVolleyball.x=140,this.messages.pikachuVolleyball.width=200-15*(e-44)):e>55&&e<=71?(this.messages.pikachuVolleyball.x=140,this.messages.pikachuVolleyball.width=40+15*(e-55)):e>71&&(this.messages.pikachuVolleyball.x=140,this.messages.pikachuVolleyball.width=this.messages.pikachuVolleyball.texture.width);else this.messages.pikachuVolleyball.visible=!1}drawPokemonMessage(e){0!==e?e>71&&(this.messages.pokemon.visible=!0):this.messages.pokemon.visible=!1}drawWithWhoMessages(e){const t=this.messages.withWho,s=t[0].texture.width,n=t[0].texture.height;if(0!==e){if(e>70){this.selectedWithWhoMessageSizeIncrement<10&&(this.selectedWithWhoMessageSizeIncrement+=1);for(let e=0;e<2;e++){const i=Number(this.selectedWithWho===e),o=i*(this.selectedWithWhoMessageSizeIncrement+2),a=i*this.selectedWithWhoMessageSizeIncrement;t[e].visible=!0,t[e].x=216-s/2-o,t[e].y=184+30*e-a,t[e].width=s+2*o,t[e].height=n+2*a}}}else for(let e=0;e<2;e++)t[e].visible=!1}selectWithWho(e){this.selectedWithWho=e,this.selectedWithWhoMessageSizeIncrement=2}}class E{constructor(e){const t=e[w].textures;this.bgContainer=function(e){const t=new n.b;let s,i=e[v.SKY_BLUE];for(let e=0;e<12;e++)for(let o=0;o<27;o++)s=new n.f(i),S(t,s,16*o,16*e);i=e[v.MOUNTAIN],s=new n.f(i),S(t,s,0,188),i=e[v.GROUND_RED];for(let e=0;e<27;e++)s=new n.f(i),S(t,s,16*e,248);i=e[v.GROUND_LINE];for(let e=1;e<26;e++)s=new n.f(i),S(t,s,16*e,264);i=e[v.GROUND_LINE_LEFT_MOST],s=new n.f(i),S(t,s,0,264),i=e[v.GROUND_LINE_RIGHT_MOST],s=new n.f(i),S(t,s,416,264),i=e[v.GROUND_YELLOW];for(let e=0;e<2;e++)for(let o=0;o<27;o++)s=new n.f(i),S(t,s,16*o,280+16*e);i=e[v.NET_PILLAR_TOP],s=new n.f(i),S(t,s,213,176),i=e[v.NET_PILLAR];for(let e=0;e<12;e++)s=new n.f(i),S(t,s,213,184+8*e);return t}(t);const s=function(e){const t=(t,s)=>e[v.PIKACHU(t,s)],s=[];for(let e=0;e<7;e++)if(3===e)s.push(t(e,0)),s.push(t(e,1));else if(4===e)s.push(t(e,0));else for(let n=0;n<5;n++)s.push(t(e,n));const i=new n.a(s,!1),o=new n.a(s,!1);return i.anchor.x=.5,i.anchor.y=.5,o.anchor.x=.5,o.anchor.y=.5,[i,o]}(t);this.player1=s[0],this.player2=s[1],this.ball=function(e){const t=t=>e[v.BALL(t)],s=[t(0),t(1),t(2),t(3),t(4),t("hyper")],i=new n.a(s,!1);return i.anchor.x=.5,i.anchor.y=.5,i}(t),this.ballHyper=k(t,v.BALL_HYPER,.5,.5),this.ballTrail=k(t,v.BALL_TRAIL,.5,.5),this.punch=k(t,v.BALL_PUNCH,.5,.5),this.scoreBoards=[L(t),L(t)],this.shadows={forPlayer1:k(t,v.SHADOW,.5,.5),forPlayer2:k(t,v.SHADOW,.5,.5),forBall:k(t,v.SHADOW,.5,.5)},this.messages={gameStart:k(t,v.GAME_START,0,0),ready:k(t,v.READY,0,0),gameEnd:k(t,v.GAME_END,0,0)},this.cloudContainer=function(e){const t=new n.b,s=e[v.CLOUD];for(let e=0;e<10;e++){const e=new n.f(s);e.anchor.x=0,e.anchor.y=0,t.addChild(e)}return t}(t),this.waveContainer=function(e){const t=new n.b,s=e[v.WAVE];for(let e=0;e<27;e++){const i=new n.f(s);S(t,i,16*e,0)}return t}(t),this.container=new n.b,this.container.addChild(this.bgContainer),this.container.addChild(this.cloudContainer),this.container.addChild(this.waveContainer),this.container.addChild(this.shadows.forPlayer1),this.container.addChild(this.shadows.forPlayer2),this.container.addChild(this.shadows.forBall),this.container.addChild(this.player1),this.container.addChild(this.player2),this.container.addChild(this.ballTrail),this.container.addChild(this.ballHyper),this.container.addChild(this.ball),this.container.addChild(this.punch),this.container.addChild(this.scoreBoards[0]),this.container.addChild(this.scoreBoards[1]),this.container.addChild(this.messages.gameStart),this.container.addChild(this.messages.ready),this.container.addChild(this.messages.gameEnd),this.bgContainer.x=0,this.bgContainer.y=0,this.cloudContainer.x=0,this.cloudContainer.y=0,this.waveContainer.x=0,this.waveContainer.y=0,this.messages.ready.x=176,this.messages.ready.y=38,this.scoreBoards[0].x=14,this.scoreBoards[0].y=10,this.scoreBoards[1].x=354,this.scoreBoards[1].y=10,this.shadows.forPlayer1.y=273,this.shadows.forPlayer2.y=273,this.shadows.forBall.y=273,this.initializeVisibles(),this.cloudArray=[];for(let e=0;e<10;e++)this.cloudArray.push(new g);this.wave=new f}get visible(){return this.container.visible}set visible(e){this.container.visible=e,!1===e&&this.initializeVisibles()}initializeVisibles(){for(const e in this.messages)this.messages[e].visible=!1}drawPlayersAndBall(e){const t=e.player1,s=e.player2,n=e.ball;this.player1.x=t.x,this.player1.y=t.y,3===t.state||4===t.state?this.player1.scale.x=-1===t.divingDirection?-1:1:this.player1.scale.x=1,this.shadows.forPlayer1.x=t.x,this.player2.x=s.x,this.player2.y=s.y,3===s.state||4===s.state?this.player2.scale.x=1===s.divingDirection?1:-1:this.player2.scale.x=-1,this.shadows.forPlayer2.x=s.x;const i=B(t.state,t.frameNumber),o=B(s.state,s.frameNumber);this.player1.gotoAndStop(i),this.player2.gotoAndStop(o),this.ball.x=n.x,this.ball.y=n.y,this.shadows.forBall.x=n.x,this.ball.gotoAndStop(n.rotation),n.punchEffectRadius>0?(n.punchEffectRadius-=2,this.punch.width=2*n.punchEffectRadius,this.punch.height=2*n.punchEffectRadius,this.punch.x=n.punchEffectX,this.punch.y=n.punchEffectY,this.punch.visible=!0):this.punch.visible=!1,!0===n.isPowerHit?(this.ballHyper.x=n.previousX,this.ballHyper.y=n.previousY,this.ballTrail.x=n.previousPreviousX,this.ballTrail.y=n.previousPreviousY,this.ballHyper.visible=!0,this.ballTrail.visible=!0):(this.ballHyper.visible=!1,this.ballTrail.visible=!1)}drawScoresToScoreBoards(e){for(let t=0;t<2;t++){const s=this.scoreBoards[t],n=e[t],i=s.getChildAt(0),o=s.getChildAt(1);i.gotoAndStop(n%10),o.gotoAndStop(Math.floor(n/10)%10),o.visible=n>=10}}drawCloudsAndWave(){const e=this.cloudArray,t=this.wave;!function(e,t){for(let t=0;t<10;t++)e[t].topLeftPointX+=e[t].topLeftPointXVelocity,e[t].topLeftPointX>432&&(e[t].topLeftPointX=-68,e[t].topLeftPointY=a()%152,e[t].topLeftPointXVelocity=1+a()%2),e[t].sizeDiffTurnNumber=(e[t].sizeDiffTurnNumber+1)%11;t.verticalCoord+=t.verticalCoordVelocity,t.verticalCoord>32?(t.verticalCoord=32,t.verticalCoordVelocity=-1):t.verticalCoord<0&&t.verticalCoordVelocity<0&&(t.verticalCoordVelocity=2,t.verticalCoord=-a()%40);for(let e=0;e<27;e++)t.yCoords[e]=314-t.verticalCoord+a()%3}(e,t);for(let t=0;t<10;t++){const s=e[t],n=this.cloudContainer.getChildAt(t);n.x=s.spriteTopLeftPointX,n.y=s.spriteTopLeftPointY,n.width=s.spriteWidth,n.height=s.spriteHeight}for(let e=0;e<27;e++){this.waveContainer.getChildAt(e).y=t.yCoords[e]}}drawGameStartMessage(e,t){if(0===e)this.messages.gameStart.visible=!0;else if(e>=t-1)return void(this.messages.gameStart.visible=!1);const s=this.messages.gameStart,n=s.texture.width,i=s.texture.height,o=Math.floor(n*e/50),a=Math.floor(i*e/50);s.x=216-o,s.y=50+2*a,s.width=2*o,s.height=2*a}drawReadyMessage(e){this.messages.ready.visible=e}toggleReadyMessage(){this.messages.ready.visible=!this.messages.ready.visible}drawGameEndMessage(e){const t=this.messages.gameEnd,s=t.texture.width,n=t.texture.height;if(0===e&&(t.visible=!0),e<50){const i=2*Math.floor((50-e)*s/50),o=2*Math.floor((50-e)*n/50);t.x=216-s/2-i,t.y=50-o,t.width=s+2*i,t.height=n+2*o}else t.x=216-s/2,t.y=50,t.width=s,t.height=n}}class x{constructor(){this.black=new n.c,this.black.beginFill(0),this.black.drawRect(0,0,432,304),this.black.endFill(),this.black.x=0,this.black.y=0,this.black.alpha=1}get visible(){return this.black.visible}set visible(e){this.black.visible=e}setBlackAlphaTo(e){this.black.alpha=e,0===this.black.alpha?this.black.visible=!1:this.black.visible=!0}changeBlackAlphaBy(e){this.black.alpha=e>=0?Math.min(1,this.black.alpha+e):Math.max(0,this.black.alpha+e),0===this.black.alpha?this.black.visible=!1:this.black.visible=!0}}function k(e,t,s,i){const o=new n.f(e[t]);return o.anchor.x=s,o.anchor.y=i,o}function L(e){const t=[];for(let n=0;n<10;n++)t.push((s=n,e[v.NUMBER(s)]));var s;const i=[null,null];i[0]=new n.a(t,!1),i[1]=new n.a(t,!1);const o=new n.b;return S(o,i[0],32,0),S(o,i[1],0,0),o.setChildIndex(i[0],0),o.setChildIndex(i[1],1),o}function S(e,t,s,n){e.addChild(t),t.anchor.x=0,t.anchor.y=0,t.x=s,t.y=n}function B(e,t){return e<4?5*e+t:4===e?17+t:e>4?18+5*(e-5)+t:void 0}class P extends c{constructor(e,t,s,n,i,o=null){super(),this.powerHitKeyIsDownPrevious=!1,this.leftKey=new D(e),this.rightKey=new D(t),this.upKey=new D(s),this.downKey=new D(n),this.powerHitKey=new D(i),this.downRightKey=new D(o)}getInput(){this.leftKey.isDown?this.xDirection=-1:this.rightKey.isDown||this.downRightKey&&this.downRightKey.isDown?this.xDirection=1:this.xDirection=0,this.upKey.isDown?this.yDirection=-1:this.downKey.isDown||this.downRightKey&&this.downRightKey.isDown?this.yDirection=1:this.yDirection=0;const e=this.powerHitKey.isDown;!this.powerHitKeyIsDownPrevious&&e?this.powerHit=1:this.powerHit=0,this.powerHitKeyIsDownPrevious=e}subscribe(){this.leftKey.subscribe(),this.rightKey.subscribe(),this.upKey.subscribe(),this.downKey.subscribe(),this.powerHitKey.subscribe(),this.downRightKey.subscribe()}unsubscribe(){this.leftKey.unsubscribe(),this.rightKey.unsubscribe(),this.upKey.unsubscribe(),this.downKey.unsubscribe(),this.powerHitKey.unsubscribe(),this.downRightKey.unsubscribe()}}class D{constructor(e){this.value=e,this.isDown=!1,this.isUp=!0,this.downListener=this.downHandler.bind(this),this.upListner=this.upHandler.bind(this),this.subscribe()}downHandler(e){e.code===this.value&&(this.isDown=!0,this.isUp=!1,e.preventDefault())}upHandler(e){e.code===this.value&&(this.isDown=!1,this.isUp=!0,e.preventDefault())}subscribe(){window.addEventListener("keydown",this.downListener),window.addEventListener("keyup",this.upListner)}unsubscribe(){window.removeEventListener("keydown",this.downListener),window.removeEventListener("keyup",this.upListner)}}const A=b.a.SOUNDS;class M{constructor(e){this.sounds={bgm:new T(e[A.BGM].sound),pipikachu:new T(e[A.PIPIKACHU].sound),pika:new T(e[A.PIKA].sound),chu:new T(e[A.CHU].sound),pi:new T(e[A.PI].sound),pikachu:new T(e[A.PIKACHU].sound),powerHit:new T(e[A.POWERHIT].sound),ballTouchesGround:new T(e[A.BALLTOUCHESGROUND].sound)},this.sounds.bgm.loop=!0,this.properBGMVolume=.2,this.properSFXVolume=.35,this.adjustVolume()}adjustVolume(){for(const e in this.sounds)this.sounds[e].volume="bgm"===e?this.properBGMVolume:this.properSFXVolume}turnBGMVolume(e){let t;t=e?this.properBGMVolume:0,this.sounds.bgm.volume=t}turnSFXVolume(e){let t;t=e?this.properSFXVolume:0;for(const e in this.sounds)"bgm"!==e&&(this.sounds[e].volume=t)}}class T{constructor(e){this.center=e,this.left=i.a.Sound.from(e.url),this.right=i.a.Sound.from(e.url);const t=new i.a.filters.StereoFilter(0),s=new i.a.filters.StereoFilter(-.75),n=new i.a.filters.StereoFilter(.75);this.center.filters=[t],this.left.filters=[s],this.right.filters=[n]}set volume(e){this.center.volume=e,this.left.volume=e,this.right.volume=e}set loop(e){this.center.loop=e,this.left.loop=e,this.right.loop=e}play(e=0){0===e?this.center.play():-1===e?this.left.play():1===e&&this.right.play()}stop(){this.center.stop(),this.left.stop(),this.right.stop()}}var V=s(17);s(40);var N=s(20),O=s.n(N);function R(e,t){return(e%t+t)%t}function _(e,t,s,n){const i=R(e,n);if(R(t,n)<=R(s,n)){if(R(t,n)<=i&&i<=R(s,n))return!0}else if(R(t,n)<=i||i<=R(s,n))return!0;return!1}const W=function(){const e="23456789abcdefghijkmnpqrstuvwxyz";let t=0;const s=[];return function(){let n=Date.now();const i=n===t;t=n;const o=new Array(10);for(let t=9;t>=0;t--)o[t]=e.charAt(n%32),n=Math.floor(n/32);if(0!==n)throw new Error("We should have converted the entire timestamp.");let a=o.join("");if(i){let e;for(e=9;e>=0&&31===s[e];e--)s[e]=0;s[e]++}else for(let e=0;e<10;e++)s[e]=Math.floor(32*Math.random());for(let t=0;t<10;t++)a+=e.charAt(s[t]);if(20!==a.length)throw new Error("Length should be 20.");return a}}(),F={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}]};let H=null,K=null;async function G(e,t,s,n,i){H=new RTCPeerConnection(F);let o=!1,a=!1,r=!1,c=!1;const l=[];H.addEventListener("icecandidate",d=>{if(!d.candidate){if(console.log("Got final candidate!"),K&&K.close(),H&&H.close(),1===Object.keys(l).length){var h=l[Object.keys(l)[0]];c=1!==h.length,console.log(c?"symmetric nat":"normal nat")}return r||a?c?(console.log("behind symmetric nat"),i()):(a||r&&!c)&&(console.log('"host address is public IP" or "got srflx, not behind symmetric nat"'),t()):(console.log("did not get srflx"),o?(console.log("host address is obfuscted"),n()):(console.log("host address is not obfuscated"),s())),void e()}const u=function(e){for(var t,s={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":s.relatedAddress=t[n+1];break;case"rport":s.relatedPort=parseInt(t[n+1],10);break;case"tcptype":s.tcpType=t[n+1];break;case"ufrag":s.ufrag=t[n+1],s.usernameFragment=t[n+1];break;default:s[t[n]]=t[n+1]}return s}(d.candidate.candidate);if("srflx"===u.type)r=!0,l[u.relatedPort]?l[u.relatedPort][0]!==u.port&&l[u.relatedPort].push(u.port):l[u.relatedPort]=[u.port];else if("host"===u.type)if(u.ip.endsWith(".local"))o=!0;else{RegExp("(^127.)|(^10.)|(^172.1[6-9].)|(^172.2[0-9].)|(^172.3[0-1].)|(^192.168.)").test(u.ip)||(a=!0)}console.log("Got candidate: ",d.candidate)}),K=H.createDataChannel("test",{ordered:!0,maxRetransmits:0});const d=await H.createOffer();await H.setLocalDescription(d)}const U="https://pikavolley-online.du.r.appspot.com";let Q=null,X=null;const j="initial",z="roomCreated",Y="quickMatchSuccess",q="withFriendSuccess",$="cancel",J={createRoom:"createRoom",keepWait:"keepWait",connectToPeer:"connectToPeer",connectToPeerAfterAWhile:"connectToPeerAfterAWhile",waitPeerConnection:"waitPeerConnection",abandoned:"abandoned"};async function Z(e="",t={}){try{return(await fetch(e,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(t)})).json()}catch(e){he(e),he(document.getElementById("failed-to-connect-to-server").textContent)}}const ee=e=>{if(null!==e.numOfSuccess){const i=e.numOfSuccess;t=i.withinLast24hours,s=i.withinLast1hour,n=i.withinLast10minutes,document.getElementById("within-24-hours").textContent=String(t),document.getElementById("within-1-hour").textContent=String(s),document.getElementById("within-10-minutes").textContent=String(n)}var t,s,n,i;switch(e.message){case J.createRoom:console.log("Create room!"),Ge(Q),window.setTimeout(()=>{Z(U,te(z,Q)).then(ee)},1e3);break;case J.keepWait:console.log("Keep wait!"),window.setTimeout(()=>{Z(U,te(z,Q)).then(ee)},1e3);break;case J.waitPeerConnection:console.log("Wait peer connection!");break;case J.connectToPeerAfterAWhile:console.log("Connect To Peer after 5 seconds..."),window.setTimeout(()=>{console.log("Connect To Peer!"),de(J.connectToPeer),Ue(e.roomId)},5e3);break;case J.connectToPeer:console.log("Connect To Peer!"),Ue(e.roomId);break;case J.abandoned:console.log("room id abandoned.. please retry quick match.");break;case J.cancelAccepted:console.log("quick match cancel accepted")}X++,i=X,document.getElementById("communication-count").textContent=String(i),de(e.message)};function te(e,t){return{message:e,roomId:t}}s(28);let se=null;const ne={toSend:null,received:null},ie=document.getElementById("chat-open-btn"),oe=document.getElementById("chat-input-and-send-btn-container"),ae=document.getElementById("chat-input"),re=document.getElementById("send-btn");function ce(e,t){!function(e){const t=document.getElementById("options-dropdown-btn"),s=document.getElementById("bgm-on-btn"),n=document.getElementById("bgm-off-btn");s.addEventListener("click",()=>{n.classList.remove("selected"),s.classList.add("selected"),e.audio.turnBGMVolume(!0)}),n.addEventListener("click",()=>{s.classList.remove("selected"),n.classList.add("selected"),e.audio.turnBGMVolume(!1)});const i=document.getElementById("stereo-btn"),o=document.getElementById("mono-btn"),a=document.getElementById("sfx-off-btn");function r(e){return e.state!==e.intro&&e.state!==e.menu&&!(e.state===e.round&&e.gameEnded)}i.addEventListener("click",()=>{o.classList.remove("selected"),a.classList.remove("selected"),i.classList.add("selected"),e.audio.turnSFXVolume(!0),e.isStereoSound=!0}),o.addEventListener("click",()=>{a.classList.remove("selected"),i.classList.remove("selected"),o.classList.add("selected"),e.audio.turnSFXVolume(!0),e.isStereoSound=!1}),a.addEventListener("click",()=>{i.classList.remove("selected"),o.classList.remove("selected"),a.classList.add("selected"),e.audio.turnSFXVolume(!1)});const c=document.getElementById("slow-speed-btn"),l=document.getElementById("medium-speed-btn"),d=document.getElementById("fast-speed-btn"),h=document.getElementById("notice-speed-options-cannot-changed-if-game-in-progress"),u=document.getElementById("notice-speed-options-cannot-changed-if-game-in-progress-ok-btn");c.addEventListener("click",()=>{if(!c.classList.contains("selected"))return r(e)?(h.classList.remove("hidden"),void(t.disabled=!0)):void ye({speed:"slow",winningScore:null})}),l.addEventListener("click",()=>{if(!l.classList.contains("selected"))return r(e)?(h.classList.remove("hidden"),void(t.disabled=!0)):void ye({speed:"medium",winningScore:null})}),d.addEventListener("click",()=>{if(!d.classList.contains("selected"))return r(e)?(h.classList.remove("hidden"),void(t.disabled=!0)):void ye({speed:"fast",winningScore:null})}),u.addEventListener("click",()=>{h.classList.contains("hidden")||(h.classList.add("hidden"),t.disabled=!1)});const m=document.getElementById("winning-score-5-btn"),y=document.getElementById("winning-score-10-btn"),p=document.getElementById("winning-score-15-btn"),g=document.getElementById("notice-winning-score-options-cannot-changed-if-game-in-progress"),f=document.getElementById("notice-winning-score-options-cannot-changed-if-game-in-progress-ok-btn");m.addEventListener("click",()=>{if(!m.classList.contains("selected"))return r(e)?(g.classList.remove("hidden"),void(t.disabled=!0)):void ye({speed:null,winningScore:5})}),y.addEventListener("click",()=>{if(!y.classList.contains("selected"))return r(e)?(g.classList.remove("hidden"),void(t.disabled=!0)):void ye({speed:null,winningScore:10})}),p.addEventListener("click",()=>{if(!p.classList.contains("selected"))return r(e)?(g.classList.remove("hidden"),void(t.disabled=!0)):void ye({speed:null,winningScore:15})}),f.addEventListener("click",()=>{g.classList.contains("hidden")||(g.classList.add("hidden"),t.disabled=!1)})}(e),window.addEventListener("click",e=>{e.target.matches(".dropdown-btn, .submenu-btn")||(ke(),xe(""))}),document.getElementById("options-dropdown-btn").addEventListener("click",()=>{var e;e="options-dropdown",ke(),xe(e),document.getElementById(e).classList.toggle("show")}),document.getElementById("bgm-submenu-btn").addEventListener("mouseover",()=>{Ee("bgm-submenu-btn","bgm-submenu")}),document.getElementById("sfx-submenu-btn").addEventListener("mouseover",()=>{Ee("sfx-submenu-btn","sfx-submenu")}),document.getElementById("speed-submenu-btn").addEventListener("mouseover",()=>{Ee("speed-submenu-btn","speed-submenu")}),document.getElementById("winning-score-submenu-btn").addEventListener("mouseover",()=>{Ee("winning-score-submenu-btn","winning-score-submenu")}),document.getElementById("bgm-submenu-btn").addEventListener("click",()=>{Ee("bgm-submenu-btn","bgm-submenu")}),document.getElementById("sfx-submenu-btn").addEventListener("click",()=>{Ee("sfx-submenu-btn","sfx-submenu")}),document.getElementById("speed-submenu-btn").addEventListener("click",()=>{Ee("speed-submenu-btn","speed-submenu")}),document.getElementById("winning-score-submenu-btn").addEventListener("click",()=>{Ee("winning-score-submenu-btn","winning-score-submenu")}),se=s=>{if(s.speed){const n=document.getElementById("slow-speed-btn"),i=document.getElementById("medium-speed-btn"),o=document.getElementById("fast-speed-btn");switch(s.speed){case"slow":i.classList.remove("selected"),o.classList.remove("selected"),n.classList.add("selected"),e.normalFPS=20,t.maxFPS=e.normalFPS;break;case"medium":o.classList.remove("selected"),n.classList.remove("selected"),i.classList.add("selected"),e.normalFPS=25,t.maxFPS=e.normalFPS;break;case"fast":n.classList.remove("selected"),i.classList.remove("selected"),o.classList.add("selected"),e.normalFPS=30,t.maxFPS=e.normalFPS}}else if(s.winningScore){const t=document.getElementById("winning-score-5-btn"),n=document.getElementById("winning-score-10-btn"),i=document.getElementById("winning-score-15-btn");switch(s.winningScore){case 5:n.classList.remove("selected"),i.classList.remove("selected"),t.classList.add("selected"),e.winningScore=5;break;case 10:i.classList.remove("selected"),t.classList.remove("selected"),n.classList.add("selected"),e.winningScore=10;break;case 15:t.classList.remove("selected"),n.classList.remove("selected"),i.classList.add("selected"),e.winningScore=15}}};const s=document.getElementById("ask-options-change-send-to-peer"),n=document.getElementById("ask-options-change-send-to-peer-yes-btn"),i=document.getElementById("ask-options-change-send-to-peer-no-btn");n.addEventListener("click",()=>{!function(e){if(!e.speed&&!e.winningScore)return;let t=JSON.stringify(e);t+=String(Re.syncCounter),Fe.send(t),Re.resendIntervalID=setInterval(()=>Fe.send(t),1e3)}(ne.toSend),s.classList.contains("hidden")||s.classList.add("hidden")}),i.addEventListener("click",()=>{s.classList.contains("hidden")||s.classList.add("hidden"),fe()});const o=document.getElementById("ask-options-change-received-from-peer"),a=document.getElementById("ask-options-change-received-from-peer-yes-btn"),r=document.getElementById("ask-options-change-received-from-peer-no-btn");a.addEventListener("click",()=>{o.classList.contains("hidden")||o.classList.add("hidden"),qe(!0),se(ne.received),fe()}),r.addEventListener("click",()=>{o.classList.contains("hidden")||o.classList.add("hidden"),qe(!1),fe()});const c=document.getElementById("notice-peer-agreed");document.getElementById("notice-peer-agreed-ok-btn").addEventListener("click",()=>{c.classList.contains("hidden")||c.classList.add("hidden"),fe()});const l=document.getElementById("notice-peer-disagreed");document.getElementById("notice-peer-disagreed-ok-btn").addEventListener("click",()=>{l.classList.contains("hidden")||l.classList.add("hidden"),fe()})}function le(e){const t=`${e.slice(0,5)}-${e.slice(5,10)}-${e.slice(10,15)}-${e.slice(15)}`;document.getElementById("current-room-id").textContent=t}function de(e){let t="";switch(e){case J.createRoom:t=document.getElementById("waiting-message").textContent;break;case J.keepWait:return;case J.waitPeerConnection:t=document.getElementById("waiting-peer-to-connect-message").textContent;break;case J.connectToPeerAfterAWhile:t=document.getElementById("connect-to-peer-after-a-while-message").textContent;break;case J.connectToPeer:t=document.getElementById("connect-to-peer-message").textContent;break;case J.abandoned:t=document.getElementById("abandoned-message").textContent;break;default:return}he(t)}function he(e){const t=document.getElementById("quick-match-log");t.textContent+=e+"\n",t.scrollIntoView()}function ue(e){let t="connection-log-with-friend";Te.isQuickMatch&&(t="connection-log-quick-match");const s=document.getElementById(t);s.textContent+=e+"\n",s.scrollIntoView()}function me(e){document.getElementById("starts-in").textContent=String(e)}function ye(e){const t=document.getElementById("options-change-to-send");if(e.speed)switch(t.textContent=document.getElementById("speed-submenu-btn").textContent.trim()+" ",e.speed){case"slow":t.textContent+=document.getElementById("slow-speed-btn").textContent.replace("✓","").trim();break;case"medium":t.textContent+=document.getElementById("medium-speed-btn").textContent.replace("✓","").trim();break;case"fast":t.textContent+=document.getElementById("fast-speed-btn").textContent.replace("✓","").trim()}else{if(!e.winningScore)return;switch(t.textContent=document.getElementById("winning-score-submenu-btn").textContent.trim()+" ",e.winningScore){case 5:t.textContent+=document.getElementById("winning-score-5-btn").textContent.replace("✓","").trim();break;case 10:t.textContent+=document.getElementById("winning-score-10-btn").textContent.replace("✓","").trim();break;case 15:t.textContent+=document.getElementById("winning-score-15-btn").textContent.replace("✓","").trim()}}ne.toSend=e,document.getElementById("ask-options-change-send-to-peer").classList.remove("hidden"),be()}function pe(){document.getElementById("notice-disconnected").classList.remove("hidden")}function ge(){ie.disabled=!1}function fe(){document.getElementById("options-dropdown-btn").disabled=!1}function be(){document.getElementById("options-dropdown-btn").disabled=!0}function we(){ae.disabled=!0,ie.disabled=!0,re.disabled=!0}function ve(){ie.disabled=!0,ae.disabled=!1,re.disabled=!1,at.unsubscribe(),ie.classList.contains("hidden")||ie.classList.add("hidden"),oe.classList.remove("hidden"),ae.focus({preventScroll:!0})}function Ce(){we(),at.subscribe(),oe.classList.contains("hidden")||oe.classList.add("hidden"),ie.classList.remove("hidden");const e=ae.value;""!==e?(ae.value="",function(e){Oe.pendingMessage=e;const t=e+String(Oe.syncCounter);Fe.send(t),Oe.resendIntervalID=setInterval(()=>Fe.send(t),1e3)}(e)):ge()}function Ie(e,t){document.getElementById(e).addEventListener("click",()=>{const e=document.getElementById(t);e.classList.contains("hidden")||e.classList.add("hidden")})}function Ee(e,t){ke(),document.getElementById(e).classList.add("open"),document.getElementById(t).classList.add("show")}function xe(e){const t=document.getElementsByClassName("dropdown");for(let s=0;s<t.length;s++)t[s].id!==e&&t[s].classList.remove("show")}function ke(){const e=document.getElementsByClassName("submenu");for(let t=0;t<e.length;t++)e[t].classList.remove("show");const t=document.getElementsByClassName("submenu-btn");for(let e=0;e<t.length;e++)t[e].classList.remove("open")}let Le=null,Se=null,Be=null;const Pe=document.getElementById("game-canvas-container");let De=document.getElementById("player1-chat-box"),Ae=document.getElementById("player2-chat-box");function Me(e,t){if(1===t){const t=De.cloneNode();t.textContent=e,t.style.top=20+30*Se()+"%",t.style.right=55+25*Se()+"%",Le&&!Le()?t.classList.remove("in-speech-bubble"):t.classList.contains("in-speech-bubble")||t.classList.add("in-speech-bubble"),Pe.replaceChild(t,De),De=t}else if(2===t){const t=Ae.cloneNode();t.textContent=e,t.style.top=20+30*Be()+"%",t.style.left=55+25*Be()+"%",Le&&!Le()?t.classList.remove("in-speech-bubble"):t.classList.contains("in-speech-bubble")||t.classList.add("in-speech-bubble"),Pe.replaceChild(t,Ae),Ae=t}}V.initializeApp({apiKey:"AIzaSyD7N4M8HsRsbP5cAYqww0LyLmjEJABHbnc",authDomain:"pikavolley-online.firebaseapp.com",databaseURL:"https://pikavolley-online.firebaseio.com",projectId:"pikavolley-online",storageBucket:"pikavolley-online.appspot.com",messagingSenderId:"16042256604",appId:"1:16042256604:web:2caf500ea81c36f550ec19",measurementId:"G-ZCQ5ESKJQL"});const Te={isOpen:!1,gameStartAllowed:!1,amICreatedRoom:!1,amIPlayer2:null,isQuickMatch:null,peerInputQueue:[],_peerInputQueueSyncCounter:0,get peerInputQueueSyncCounter(){return this._peerInputQueueSyncCounter},set peerInputQueueSyncCounter(e){this._peerInputQueueSyncCounter=R(e,256)},callbackAfterDataChannelOpened:null,callbackAfterDataChannelOpenedForUI:null,callbackAfterPeerInputQueueReceived:null},Ve={pingSentTimeArray:new Array(5),receivedPingResponseNumber:0,pingMesurementArray:[]};function Ne(e){return{pendingMessage:"",resendIntervalID:null,_syncCounter:e,_peerSyncCounter:e+(e+1)%2,get syncCounter(){return this._syncCounter},set syncCounter(t){this._syncCounter=e+t%2},get peerSyncCounter(){return this._peerSyncCounter},set peerSyncCounter(t){this._peerSyncCounter=e+t%2},get nextPeerSyncCounter(){return e+(this._peerSyncCounter+1)%2}}}const Oe=Ne(0),Re=Ne(2),_e=Ne(4);let We=null,Fe=null,He=null,Ke=!0;async function Ge(e){Te.amICreatedRoom=!0,He=e;const t=V.firestore().collection("rooms").doc(He);console.log("Create PeerConnection with configuration: ",F),We=new RTCPeerConnection(F),st(We),nt(t,We,"offerorCandidates","answererCandidates"),console.log("Create DataChannel",Fe),Fe=We.createDataChannel("pikavolley_p2p_channel",{ordered:!0,maxRetransmits:0}),Fe.addEventListener("open",et),Fe.addEventListener("message",Ze),Fe.addEventListener("close",tt),t.onSnapshot(async e=>{console.log("Got updated room:",e.data());const t=e.data();if(!We.currentRemoteDescription&&t.answer){ue("Answer received"),console.log("Set remote description");const e=t.answer;await We.setRemoteDescription(e)}});const s=await We.createOffer();await We.setLocalDescription(s),console.log("Created offer and set local description:",s);const n={offer:{type:s.type,sdp:s.sdp}};t.set(n),console.log("New room created with SDP offer. Room ID: "+t.id),ue("Offer sent")}async function Ue(e){if(He=e,20!==He.length)return ue(document.getElementById("not-valid-room-id-message").textContent),!1;console.log("Join room: ",He);const t=V.firestore().collection("rooms").doc(""+He),s=await t.get();if(console.log("Got room:",s.exists),!s.exists)return ue(document.getElementById("no-room-matching-message").textContent),!1;console.log("Create PeerConnection with configuration: ",F),We=new RTCPeerConnection(F),st(We),nt(t,We,"answererCandidates","offerorCandidates");const n=s.data().offer;await We.setRemoteDescription(n),console.log("Set remote description"),ue("Offer received");const i=await We.createAnswer();await We.setLocalDescription(i),console.log("set local description:",i);const o={answer:{type:i.type,sdp:i.sdp}};return await t.update(o),ue("Answer sent"),console.log("joined room!"),!0}async function Qe(){if(Fe&&Fe.close(),We&&We.close(),He){const e=V.firestore().collection("rooms").doc(He);await e.delete(),console.log("did room delete!")}console.log("Did close and Cleaning!")}function Xe(e){Ke&&(Ke=!1,function(){const e=document.getElementById("peer-loading-box");e.classList.contains("hidden")||e.classList.add("hidden")}());const t=new DataView(e),s=t.getUint8(0);for(let n=0;n<e.byteLength-1;n++){const e=R(s+n,256);if(e===Te.peerInputQueueSyncCounter&&(0===Te.peerInputQueue.length||_(e,Te.peerInputQueue[0].syncCounter,Te.peerInputQueue[0].syncCounter+2*it-1,256))){const s=t.getUint8(1+n);let i,o;switch(s%4){case 0:i=0;break;case 1:i=1;break;case 3:i=-1}switch((s>>>2)%4){case 0:o=0;break;case 1:o=1;break;case 3:o=-1}const a=new ct(e,i,o,s>>>4);Te.peerInputQueue.push(a),Te.peerInputQueueSyncCounter++}}}function je(e){var t;new DataView(e).getInt8(0)===Oe.syncCounter&&(Oe.syncCounter++,clearInterval(Oe.resendIntervalID),t=Oe.pendingMessage,null===Te.amIPlayer2?Te.amICreatedRoom?Me(t,1):Me(t,2):!1===Te.amIPlayer2?Me(t,1):!0===Te.amIPlayer2&&Me(t,2),ge())}function ze(e){const t=Number(e.slice(-1));if(t===Oe.peerSyncCounter)console.log("arraybuffer with length 1 for chat message ACK resent");else{if(t!==Oe.nextPeerSyncCounter)return void console.log("invalid chat message received.");Oe.peerSyncCounter++,s=e.slice(0,-1),null===Te.amIPlayer2?Te.amICreatedRoom?Me(s,2):Me(s,1):!1===Te.amIPlayer2?Me(s,2):!0===Te.amIPlayer2&&Me(s,1)}var s;const n=new ArrayBuffer(1);new DataView(n).setInt8(0,t),Fe.send(n)}function Ye(e){const t=Number(e.slice(-1));if(t===Re.peerSyncCounter)console.log("arraybuffer with length 1 for options change message ACK resent");else{if(t!==Re.nextPeerSyncCounter)return void console.log("invalid options change message received.");Re.peerSyncCounter++,function(e){const t=document.getElementById("options-change-received");if(e.speed)switch(t.textContent=document.getElementById("speed-submenu-btn").textContent.trim()+" ",e.speed){case"slow":t.textContent+=document.getElementById("slow-speed-btn").textContent.replace("✓","").trim();break;case"medium":t.textContent+=document.getElementById("medium-speed-btn").textContent.replace("✓","").trim();break;case"fast":t.textContent+=document.getElementById("fast-speed-btn").textContent.replace("✓","").trim()}else{if(!e.winningScore)return;switch(t.textContent=document.getElementById("winning-score-submenu-btn").textContent.trim()+" ",e.winningScore){case 5:t.textContent+=document.getElementById("winning-score-5-btn").textContent.replace("✓","").trim();break;case 10:t.textContent+=document.getElementById("winning-score-10-btn").textContent.replace("✓","").trim();break;case 15:t.textContent+=document.getElementById("winning-score-15-btn").textContent.replace("✓","").trim()}}ne.received=e,document.getElementById("ask-options-change-received-from-peer").classList.remove("hidden"),be(),ke(),xe("")}(JSON.parse(e.slice(0,-1)))}const s=new ArrayBuffer(1);new DataView(s).setInt8(0,t),Fe.send(s)}function qe(e){let t=String(e);t+=String(_e.syncCounter),Fe.send(t),_e.resendIntervalID=setInterval(()=>Fe.send(t),1e3)}function $e(e){const t=Number(e.slice(-1));if(t===_e.peerSyncCounter)console.log("arraybuffer with length 1 for options change message ACK resent");else{if(t!==_e.nextPeerSyncCounter)return void console.log("invalid options change message received.");_e.peerSyncCounter++,function(e){if(e){se(ne.toSend),document.getElementById("notice-peer-agreed").classList.remove("hidden")}else{document.getElementById("notice-peer-disagreed").classList.remove("hidden")}}("true"===e.slice(0,-1))}const s=new ArrayBuffer(1);new DataView(s).setInt8(0,t),Fe.send(s)}function Je(){ue("start ping test");const e=new ArrayBuffer(1);new DataView(e).setInt8(0,-1);let t=0;const s=setInterval(()=>{if(5!==t){var n;Ve.pingSentTimeArray[t]=Date.now(),Fe.send(e),function(){let e="connection-log-with-friend";Te.isQuickMatch&&(e="connection-log-quick-match");const t=document.getElementById(e);t.textContent+=".",t.scrollIntoView()}(),t++}else{window.clearInterval(s);const e=Ve.pingMesurementArray.reduce((e,t)=>e+t,0)/Ve.pingMesurementArray.length;console.log(`average ping: ${e} ms, ping list: ${Ve.pingMesurementArray}`),Te.callbackAfterDataChannelOpened(),Te.callbackAfterDataChannelOpenedForUI(),function(){const e=document.getElementById("flex-container"),t=document.getElementById("before-connection");t.classList.contains("hidden")||t.classList.add("hidden"),e.classList.remove("hidden"),at.subscribe()}(),ge(),n=e,document.getElementById("average-ping").textContent=String(n);let t=10;me(t);const i=setInterval(()=>{if(t--,me(t),0===t)return window.clearInterval(i),function(){const e=document.getElementById("ping-box");e.classList.contains("hidden")||e.classList.add("hidden")}(),void(Te.gameStartAllowed=!0)},1e3)}},1e3)}function Ze(e){const t=e.data;if(t instanceof ArrayBuffer){if(t.byteLength>1&&t.byteLength<=1+2*it){if(Xe(t),null!==Te.callbackAfterPeerInputQueueReceived){const e=Te.callbackAfterPeerInputQueueReceived;Te.callbackAfterPeerInputQueueReceived=null,window.setTimeout(e,0)}}else if(1===t.byteLength){const e=new DataView(t).getInt8(0);e>=4?function(e){new DataView(e).getInt8(0)===_e.syncCounter&&(_e.syncCounter++,clearInterval(_e.resendIntervalID))}(t):e>=2?function(e){new DataView(e).getInt8(0)===Re.syncCounter&&(Re.syncCounter++,clearInterval(Re.resendIntervalID))}(t):e>=0?je(t):e<0&&function(e){const t=new DataView(e);if(-1===t.getInt8(0)){const e=new ArrayBuffer(1);new DataView(e).setInt8(0,-2),console.log("respond to ping"),Fe.send(e)}else-2===t.getInt8(0)&&(Ve.pingMesurementArray.push(Date.now()-Ve.pingSentTimeArray[Ve.receivedPingResponseNumber]),Ve.receivedPingResponseNumber++)}(t)}}else if("string"==typeof t){const e=Number(t.slice(-1));e>=4?$e(t):e>=2?Ye(t):e>=0&&ze(t)}}function et(){ue("data channel opened!"),console.log("data channel opened!"),console.log("dataChannel.ordered: "+Fe.ordered),console.log("dataChannel.maxRetransmits: "+Fe.maxRetransmits),Te.isOpen=!0,Fe.binaryType="arraybuffer",Te.isQuickMatch&&(document.getElementById("cancel-quick-match-btn-2").disabled=!0),Te.amICreatedRoom&&(Te.isQuickMatch?(console.log("Send quick match success message to server"),Z(U,te(Y,Q))):(console.log("Send with friend success message to server"),Z(U,te(q,Q))));const e=O.a.alea(He.slice(10));o=e,function(e,t){Se=e,Be=t}(O.a.alea(He.slice(10,15)),O.a.alea(He.slice(15))),Je()}function tt(){console.log("data channel closed"),Te.isOpen=!1,pe()}function st(e){e.addEventListener("icegatheringstatechange",()=>{console.log("ICE gathering state changed: "+e.iceGatheringState),ue("ICE gathering state changed: "+e.iceGatheringState)}),e.addEventListener("connectionstatechange",()=>{console.log("Connection state change: "+e.connectionState),ue("Connection state change: "+e.connectionState),"disconnected"!==e.connectionState&&"closed"!==e.connectionState||(Te.isOpen=!1,pe())}),e.addEventListener("signalingstatechange",()=>{console.log("Signaling state change: "+e.signalingState),ue("Signaling state change: "+e.signalingState)}),e.addEventListener("iceconnectionstatechange ",()=>{console.log("ICE connection state change: "+e.iceConnectionState),ue("ICE connection state change: "+e.iceConnectionState)}),e.addEventListener("datachannel",e=>{Fe=e.channel,console.log("data channel received!"),ue("data channel received!"),Fe.addEventListener("open",et),Fe.addEventListener("message",Ze),Fe.addEventListener("close",tt)})}function nt(e,t,s,n){const i=e.collection(s);t.addEventListener("icecandidate",e=>{if(!e.candidate)return void console.log("Got final candidate!");const t=e.candidate.toJSON();i.add(t),console.log("Got candidate: ",e.candidate)}),e.collection(n).onSnapshot(e=>{e.docChanges().forEach(async e=>{if("added"===e.type){const s=e.doc.data();await t.addIceCandidate(s),console.log("Got new remote ICE candidate")}})})}const it=8;class ot extends P{getInput(){this.leftKey.isDown?this.xDirection=-1:this.rightKey.isDown||!Te.amIPlayer2&&this.downRightKey&&this.downRightKey.isDown?this.xDirection=1:this.xDirection=0,this.upKey.isDown?this.yDirection=-1:this.downKey.isDown||this.downRightKey&&this.downRightKey.isDown?this.yDirection=1:this.yDirection=0;const e=this.powerHitKey.isDown;!this.powerHitKeyIsDownPrevious&&e?this.powerHit=1:this.powerHit=0,this.powerHitKeyIsDownPrevious=e}}const at=new class{constructor(e,t,s,n,i,o,a,r,c,l,d,h){this.keyboard1=new ot(e,t,s,n,i,o),this.keyboard2=new ot(a,r,c,l,d,h),this._syncCounter=0,this.inputQueue=[]}get syncCounter(){return this._syncCounter}set syncCounter(e){this._syncCounter=R(e,256)}subscribe(){this.keyboard1.subscribe(),this.keyboard2.subscribe()}unsubscribe(){this.keyboard1.unsubscribe(),this.keyboard2.unsubscribe()}getInputIfNeededAndSendToPeer(e){if(0===this.inputQueue.length||_(this.syncCounter,e,e+it-1,256)){this.keyboard1.getInput(),this.keyboard2.getInput();const e=0!==this.keyboard1.xDirection?this.keyboard1.xDirection:this.keyboard2.xDirection,t=0!==this.keyboard1.yDirection?this.keyboard1.yDirection:this.keyboard2.yDirection,s=0!==this.keyboard1.powerHit?this.keyboard1.powerHit:this.keyboard2.powerHit,n=new ct(this.syncCounter,e,t,s);this.inputQueue.push(n),this.syncCounter++}!function(e){const t=new ArrayBuffer(1+e.length),s=new DataView(t);s.setUint8(0,e[0].syncCounter);for(let t=0;t<e.length;t++){const n=e[t];let i=0;switch(n.xDirection){case 1:i+=1;break;case-1:i+=3}switch(n.yDirection){case 1:i+=4;break;case-1:i+=12}switch(n.powerHit){case 1:i+=16}s.setUint8(1+t,i)}Fe.send(t)}(this.inputQueue)}}("KeyD","KeyG","KeyR","KeyV","KeyZ","KeyF","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter","ArrowDown");class rt{constructor(e){this.xDirection=0,this.yDirection=0,this.powerHit=0,this.inputQueue=e,this.isHistoryBufferFilled=!1}isInputOnQueue(e){if(0===this.inputQueue.length)return!1;if(this.isHistoryBufferFilled)return this.inputQueue.length>it&&(this.inputQueue[it].syncCounter===e||(console.log("Something in OnlineKeyboard is wrong..."),!1));for(let t=0;t<this.inputQueue.length;t++)if(this.inputQueue[t].syncCounter===e)return!0;return!1}getInput(e){if(0===this.inputQueue.length)return void console.log("Something in getInput method is wrong...0");let t=null;if(this.isHistoryBufferFilled){if(!(this.inputQueue.length>it))return void console.log("Something in getInput method is wrong...2");if(t=this.inputQueue[it],t.syncCounter!==e)return void console.log("Something in getInput method is wrong...1");this.inputQueue.shift()}else for(let s=0;s<this.inputQueue.length;s++)if(this.inputQueue[s].syncCounter===e){t=this.inputQueue[s],s===it&&(this.isHistoryBufferFilled=!0,this.inputQueue.shift());break}null!==t?(this.xDirection=t.xDirection,this.yDirection=t.yDirection,this.powerHit=t.powerHit):console.log("Something in getInput method is wrong...3")}}class ct extends c{constructor(e,t,s,n){super(),this.syncCounter=e,this.xDirection=t,this.yDirection=s,this.powerHit=n}}class lt extends class{constructor(e,t){this.view={intro:new C(t),menu:new I(t),game:new E(t),fadeInOut:new x},e.addChild(this.view.intro.container),e.addChild(this.view.menu.container),e.addChild(this.view.game.container),e.addChild(this.view.fadeInOut.black),this.view.intro.visible=!1,this.view.menu.visible=!1,this.view.game.visible=!1,this.view.fadeInOut.visible=!1,this.audio=new M(t),this.physics=new r(!0,!0),this.keyboardArray=[new P("KeyD","KeyG","KeyR","KeyV","KeyZ","KeyF"),new P("ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Enter")],this.normalFPS=25,this.slowMotionFPS=5,this.SLOW_MOTION_FRAMES_NUM=6,this.slowMotionFramesLeft=0,this.slowMotionNumOfSkippedFrames=0,this.selectedWithWho=0,this.scores=[0,0],this.winningScore=15,this.gameEnded=!1,this.roundEnded=!1,this.isPlayer2Serve=!1,this.frameCounter=0,this.frameTotal={intro:165,afterMenuSelection:15,beforeStartOfNewGame:15,startOfNewGame:71,afterEndOfRound:5,beforeStartOfNextRound:30,gameEnd:211},this.noInputFrameCounter=0,this.noInputFrameTotal={menu:225},this.paused=!1,this.isStereoSound=!0,this._isPracticeMode=!1,this.state=this.intro}gameLoop(){if(!0!==this.paused){if(this.slowMotionFramesLeft>0){if(this.slowMotionNumOfSkippedFrames++,this.slowMotionNumOfSkippedFrames%Math.round(this.normalFPS/this.slowMotionFPS)!=0)return;this.slowMotionFramesLeft--,this.slowMotionNumOfSkippedFrames=0}this.keyboardArray[0].getInput(),this.keyboardArray[1].getInput(),this.state()}}intro(){0===this.frameCounter&&(this.view.intro.visible=!0,this.view.fadeInOut.setBlackAlphaTo(0),this.audio.sounds.bgm.stop()),this.view.intro.drawMark(this.frameCounter),this.frameCounter++,1!==this.keyboardArray[0].powerHit&&1!==this.keyboardArray[1].powerHit||(this.frameCounter=0,this.view.intro.visible=!1,this.state=this.menu),this.frameCounter>=this.frameTotal.intro&&(this.frameCounter=0,this.view.intro.visible=!1,this.state=this.menu)}menu(){if(0===this.frameCounter&&(this.view.menu.visible=!0,this.view.fadeInOut.setBlackAlphaTo(0),this.selectedWithWho=0,this.view.menu.selectWithWho(this.selectedWithWho)),this.view.menu.drawFightMessage(this.frameCounter),this.view.menu.drawSachisoft(this.frameCounter),this.view.menu.drawSittingPikachuTiles(this.frameCounter),this.view.menu.drawPikachuVolleyballMessage(this.frameCounter),this.view.menu.drawPokemonMessage(this.frameCounter),this.view.menu.drawWithWhoMessages(this.frameCounter),this.frameCounter++,this.frameCounter<71&&(1===this.keyboardArray[0].powerHit||1===this.keyboardArray[1].powerHit))this.frameCounter=71;else if(!(this.frameCounter<=71)){if(-1!==this.keyboardArray[0].yDirection&&-1!==this.keyboardArray[1].yDirection||1!==this.selectedWithWho?1!==this.keyboardArray[0].yDirection&&1!==this.keyboardArray[1].yDirection||0!==this.selectedWithWho?this.noInputFrameCounter++:(this.noInputFrameCounter=0,this.selectedWithWho=1,this.view.menu.selectWithWho(this.selectedWithWho),this.audio.sounds.pi.play()):(this.noInputFrameCounter=0,this.selectedWithWho=0,this.view.menu.selectWithWho(this.selectedWithWho),this.audio.sounds.pi.play()),1===this.keyboardArray[0].powerHit||1===this.keyboardArray[1].powerHit)return 1===this.selectedWithWho?(this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1):1===this.keyboardArray[0].powerHit?(this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!0):1===this.keyboardArray[1].powerHit&&(this.physics.player1.isComputer=!0,this.physics.player2.isComputer=!1),this.audio.sounds.pikachu.play(),this.frameCounter=0,this.noInputFrameCounter=0,void(this.state=this.afterMenuSelection);this.noInputFrameCounter>=this.noInputFrameTotal.menu&&(this.physics.player1.isComputer=!0,this.physics.player2.isComputer=!0,this.frameCounter=0,this.noInputFrameCounter=0,this.state=this.afterMenuSelection)}}afterMenuSelection(){this.view.fadeInOut.changeBlackAlphaBy(1/16),this.frameCounter++,this.frameCounter>=this.frameTotal.afterMenuSelection&&(this.frameCounter=0,this.state=this.beforeStartOfNewGame)}beforeStartOfNewGame(){this.frameCounter++,this.frameCounter>=this.frameTotal.beforeStartOfNewGame&&(this.frameCounter=0,this.view.menu.visible=!1,this.state=this.startOfNewGame)}startOfNewGame(){0===this.frameCounter&&(this.view.game.visible=!0,this.gameEnded=!1,this.roundEnded=!1,this.isPlayer2Serve=!1,this.physics.player1.gameEnded=!1,this.physics.player1.isWinner=!1,this.physics.player2.gameEnded=!1,this.physics.player2.isWinner=!1,this.scores[0]=0,this.scores[1]=0,this.view.game.drawScoresToScoreBoards(this.scores),this.physics.player1.initializeForNewRound(),this.physics.player2.initializeForNewRound(),this.physics.ball.initializeForNewRound(this.isPlayer2Serve),this.view.game.drawPlayersAndBall(this.physics),this.view.fadeInOut.setBlackAlphaTo(1),this.audio.sounds.bgm.play()),this.view.game.drawGameStartMessage(this.frameCounter,this.frameTotal.startOfNewGame),this.view.game.drawCloudsAndWave(),this.view.fadeInOut.changeBlackAlphaBy(-1/17),this.frameCounter++,this.frameCounter>=this.frameTotal.startOfNewGame&&(this.frameCounter=0,this.view.fadeInOut.setBlackAlphaTo(0),this.state=this.round)}round(){const e=1===this.keyboardArray[0].powerHit||1===this.keyboardArray[1].powerHit;if(!0===this.physics.player1.isComputer&&!0===this.physics.player2.isComputer&&e)return this.frameCounter=0,this.view.game.visible=!1,void(this.state=this.intro);const t=this.physics.runEngineForNextFrame(this.keyboardArray);if(this.playSoundEffect(),this.view.game.drawPlayersAndBall(this.physics),this.view.game.drawCloudsAndWave(),!0===this.gameEnded)return this.view.game.drawGameEndMessage(this.frameCounter),this.frameCounter++,void((this.frameCounter>=this.frameTotal.gameEnd||this.frameCounter>=70&&e)&&(this.frameCounter=0,this.view.game.visible=!1,this.state=this.intro));t&&!1===this._isPracticeMode&&!1===this.roundEnded&&!1===this.gameEnded&&(this.physics.ball.punchEffectX<216?(this.isPlayer2Serve=!0,this.scores[1]+=1,this.scores[1]>=this.winningScore&&(this.gameEnded=!0,this.physics.player1.isWinner=!1,this.physics.player2.isWinner=!0,this.physics.player1.gameEnded=!0,this.physics.player2.gameEnded=!0)):(this.isPlayer2Serve=!1,this.scores[0]+=1,this.scores[0]>=this.winningScore&&(this.gameEnded=!0,this.physics.player1.isWinner=!0,this.physics.player2.isWinner=!1,this.physics.player1.gameEnded=!0,this.physics.player2.gameEnded=!0)),this.view.game.drawScoresToScoreBoards(this.scores),!1===this.roundEnded&&!1===this.gameEnded&&(this.slowMotionFramesLeft=this.SLOW_MOTION_FRAMES_NUM),this.roundEnded=!0),!0===this.roundEnded&&!1===this.gameEnded&&0===this.slowMotionFramesLeft&&(this.view.fadeInOut.changeBlackAlphaBy(1/16),this.state=this.afterEndOfRound)}afterEndOfRound(){this.view.fadeInOut.changeBlackAlphaBy(1/16),this.frameCounter++,this.frameCounter>=this.frameTotal.afterEndOfRound&&(this.frameCounter=0,this.state=this.beforeStartOfNextRound)}beforeStartOfNextRound(){0===this.frameCounter&&(this.view.fadeInOut.setBlackAlphaTo(1),this.view.game.drawReadyMessage(!1),this.physics.player1.initializeForNewRound(),this.physics.player2.initializeForNewRound(),this.physics.ball.initializeForNewRound(this.isPlayer2Serve),this.view.game.drawPlayersAndBall(this.physics)),this.view.game.drawCloudsAndWave(),this.view.fadeInOut.changeBlackAlphaBy(-1/16),this.frameCounter++,this.frameCounter%5==0&&this.view.game.toggleReadyMessage(),this.frameCounter>=this.frameTotal.beforeStartOfNextRound&&(this.frameCounter=0,this.view.game.drawReadyMessage(!1),this.view.fadeInOut.setBlackAlphaTo(0),this.roundEnded=!1,this.state=this.round)}playSoundEffect(){const e=this.audio;for(let t=0;t<2;t++){const s=this.physics["player"+(t+1)].sound;let n=0;this.isStereoSound&&(n=0===t?-1:1),!0===s.pipikachu&&(e.sounds.pipikachu.play(n),s.pipikachu=!1),!0===s.pika&&(e.sounds.pika.play(n),s.pika=!1),!0===s.chu&&(e.sounds.chu.play(n),s.chu=!1)}const t=this.physics.ball,s=t.sound;let n=0;this.isStereoSound&&(t.punchEffectX<216?n=-1:t.punchEffectX>216&&(n=1)),!0===s.powerHit&&(e.sounds.powerHit.play(n),s.powerHit=!1),!0===s.ballTouchesGround&&(e.sounds.ballTouchesGround.play(n),s.ballTouchesGround=!1)}restart(){this.frameCounter=0,this.noInputFrameCounter=0,this.slowMotionFramesLeft=0,this.slowMotionNumOfSkippedFrames=0,this.view.menu.visible=!1,this.view.game.visible=!1,this.state=this.intro}get isPracticeMode(){return this._isPracticeMode}set isPracticeMode(e){this._isPracticeMode=e,this.view.game.scoreBoards[0].visible=!e,this.view.game.scoreBoards[1].visible=!e}}{constructor(e,t){super(e,t),this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1,this.keyboardArray[0].unsubscribe(),this.keyboardArray[1].unsubscribe(),this.myKeyboard=at,this.myOnlineKeyboard=new rt(this.myKeyboard.inputQueue),this.peerOnlineKeyboard=new rt(Te.peerInputQueue),this._amIPlayer2=!1,this.keyboardArray=[this.myOnlineKeyboard,this.peerOnlineKeyboard],this._syncCounter=0,this.noInputFrameTotal.menu=1/0,this.isFirstGame=!0}get amIPlayer2(){return this._amIPlayer2}set amIPlayer2(e){this._amIPlayer2=e,Te.amIPlayer2=e,!0===this._amIPlayer2?this.keyboardArray=[this.peerOnlineKeyboard,this.myOnlineKeyboard]:this.keyboardArray=[this.myOnlineKeyboard,this.peerOnlineKeyboard]}get syncCounter(){return this._syncCounter}set syncCounter(e){this._syncCounter=R(e,256)}intro(){0===this.frameCounter&&(this.isFirstGame?(this.isFirstGame=!1,fe(),Te.amICreatedRoom?this.amIPlayer2=!1:this.amIPlayer2=!0):Te.isQuickMatch&&document.getElementById("ask-one-more-game").classList.remove("hidden")),super.intro()}beforeStartOfNewGame(){0===this.frameCounter&&1===this.selectedWithWho&&(this.amIPlayer2=!this.amIPlayer2),super.beforeStartOfNewGame()}gameLoop(){Te.gameStartAllowed&&Te.isOpen&&(this.myKeyboard.getInputIfNeededAndSendToPeer(this.syncCounter),this.gameLoopFromGettingPeerInput())}gameLoopFromGettingPeerInput(){if(this.peerOnlineKeyboard.isInputOnQueue(this.syncCounter)){if(this.myOnlineKeyboard.isInputOnQueue(this.syncCounter)){if(this.peerOnlineKeyboard.getInput(this.syncCounter),this.myOnlineKeyboard.getInput(this.syncCounter),this.syncCounter++,this.slowMotionFramesLeft>0){if(this.slowMotionNumOfSkippedFrames++,this.slowMotionNumOfSkippedFrames%Math.round(this.normalFPS/this.slowMotionFPS)!=0)return;this.slowMotionFramesLeft--,this.slowMotionNumOfSkippedFrames=0}this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1,this.state(),this.peerOnlineKeyboard.inputQueue.length>it&&(this.myOnlineKeyboard.inputQueue.length>it?window.setTimeout(this.gameLoopFromGettingPeerInput.bind(this),0):window.setTimeout(this.gameLoop.bind(this),0))}}else Te.callbackAfterPeerInputQueueReceived=this.gameLoopFromGettingPeerInput.bind(this)}}const dt=b.a.TEXTURES;dt.WITH_COMPUTER=dt.WITH_FRIEND;const ht=n.i;ht.RESOLUTION=window.devicePixelRatio,ht.SCALE_MODE=n.e.NEAREST,ht.ROUND_PIXELS=!0;const ut=n.h({width:432,height:304,antialias:!1,backgroundColor:0,transparent:!1}),mt=new n.b,yt=new n.g,pt=new n.d;document.querySelector("#game-canvas-container").appendChild(ut.view),ut.render(mt),pt.add(b.a.SPRITE_SHEET);for(const e in b.a.SOUNDS)pt.add(b.a.SOUNDS[e]);function gt(){const e=new lt(mt,pt.resources);ce(e,yt),function(e){Le=()=>e.state===e.intro||e.state===e.menu}(e),function(e){yt.maxFPS=e.normalFPS,yt.add(()=>{ut.render(mt),e.gameLoop()}),yt.start()}(e)}!function(){const e=document.getElementById("loading-box"),t=document.getElementById("progress-bar");pt.on("progress",()=>{t.style.width=pt.progress+"%"}),pt.on("complete",()=>{e.classList.contains("hidden")||e.classList.add("hidden")})}(),Te.callbackAfterDataChannelOpened=()=>{pt.load(gt)},function(){at.unsubscribe(),document.getElementById("options-dropdown-btn").disabled=!0;const e=document.getElementById("network-test-btn"),t=document.getElementById("quick-match-btn"),s=document.getElementById("with-your-friend-btn"),n=document.getElementById("create-btn"),i=document.getElementById("join-btn"),o=document.getElementById("join-room-id-input"),a=()=>{e.disabled=!0,t.disabled=!0,s.disabled=!0,n.disabled=!0,i.disabled=!0,o.disabled=!0},r=()=>{e.disabled=!1,document.getElementById("about-with-your-friend").classList.contains("hidden")&&(t.disabled=!1),s.disabled=!1,n.disabled=!1,i.disabled=!1,o.disabled=!1};e.addEventListener("click",()=>{a();G(r,()=>{document.getElementById("test-passed").classList.remove("hidden")},()=>{document.getElementById("did-not-get-srflx-candidate").classList.remove("hidden")},()=>{document.getElementById("did-not-get-srflx-candidate-and-host-address-is-obfuscated").classList.remove("hidden")},()=>{document.getElementById("behind-symmetric-nat").classList.remove("hidden")})});const c=e=>{if("Enter"===e.code){e.preventDefault(),window.removeEventListener("keydown",c);const t=document.getElementById("press-enter-to-quick-match");t.classList.contains("hidden")||t.classList.add("hidden"),G(()=>{},()=>{document.getElementById("quick-match-notice-box").classList.remove("hidden");const e=W();Q=e,X=0,Z(U,te(j,Q)).then(ee)},()=>{document.getElementById("did-not-get-srflx-candidate").classList.remove("hidden"),r()},()=>{document.getElementById("did-not-get-srflx-candidate-and-host-address-is-obfuscated").classList.remove("hidden"),r()},()=>{document.getElementById("behind-symmetric-nat").classList.remove("hidden"),r()})}};t.addEventListener("click",()=>{a(),Te.isQuickMatch=!0,window.addEventListener("keydown",c),document.getElementById("press-enter-to-quick-match").classList.remove("hidden")}),s.addEventListener("click",()=>{const e=document.getElementById("about-with-your-friend");e.classList.contains("hidden")?(e.classList.remove("hidden"),t.disabled=!0):(e.classList.add("hidden"),t.disabled=!1)}),n.addEventListener("click",()=>{a(),document.getElementById("join-room-id-input").value="",Te.isQuickMatch=!1;const e=W();Ge(e).then(()=>{le(e)})}),i.addEventListener("click",()=>{a(),Te.isQuickMatch=!1;const e=document.getElementById("join-room-id-input").value.trim().split("-").join("");Ue(e).then(t=>{t?le(e):r()})}),window.addEventListener("keydown",e=>{if("Escape"===e.code){const t=document.getElementById("menu-bar");t.classList.contains("hidden")?t.classList.remove("hidden"):t.classList.add("hidden"),e.preventDefault()}}),ie.addEventListener("click",ve),re.addEventListener("click",Ce),Te.callbackAfterDataChannelOpenedForUI=()=>{window.addEventListener("keydown",e=>{"Space"===e.code?ie.classList.contains("hidden")||(ie.click(),e.preventDefault()):"Enter"===e.code&&e.preventDefault()}),window.addEventListener("keyup",e=>{"Enter"===e.code&&(oe.classList.contains("hidden")||window.setTimeout(()=>re.click(),0))})},Ie("test-passed-ok-btn","test-passed"),Ie("did-not-get-srflx-candidate-ok-btn","did-not-get-srflx-candidate"),Ie("did-not-get-srflx-candidate-and-host-address-is-obfuscated-ok-btn","did-not-get-srflx-candidate-and-host-address-is-obfuscated"),Ie("behind-symmetric-nat-ok-btn","behind-symmetric-nat"),document.getElementById("cancel-quick-match-btn").addEventListener("click",()=>{const e=document.getElementById("press-enter-to-quick-match");e.classList.contains("hidden")||e.classList.add("hidden"),r()}),document.getElementById("cancel-quick-match-btn-2").addEventListener("click",()=>{console.log("Send cancel quick match message to server"),Z(U,te($,Q)),location.reload()}),document.getElementById("notice-disconnected-ok-btn").addEventListener("click",()=>{location.reload()}),document.getElementById("ask-one-more-game-yes-btn").addEventListener("click",()=>{const e=document.getElementById("ask-one-more-game");e.classList.contains("hidden")||e.classList.add("hidden")}),document.getElementById("ask-one-more-game-no-btn").addEventListener("click",()=>{location.reload()}),window.addEventListener("unload",Qe),window.addEventListener("beforeunload",(function(e){Te.isOpen&&(e.preventDefault(),e.returnValue="")})),we()}()}},[[52,0,3]]]);
//# sourceMappingURL=main.fb52becf56ae3c514026.js.map